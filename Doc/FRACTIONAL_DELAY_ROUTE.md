# üéØ –ú–ê–†–®–†–£–¢ –û–¢–õ–ê–î–ö–ò –î–†–û–ë–ù–û–ô –ó–ê–î–ï–†–ñ–ö–ò - –ö—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞

## üìç –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –∏ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥—á–∏–∫–∞

### 1Ô∏è‚É£ –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç—Ä–∏—Ü—ã –õ–∞–≥—Ä–∞–Ω–∂–∞
**–§–∞–π–ª**: `src/main.cpp`  
**–°—Ç—Ä–æ–∫–∏**: ~25-45

```cpp
LagrangeMatrix lagrange_matrix;
lagrange_matrix.LoadFromJson("Doc/Example/lagrange_matrix.json");
gpu_backend->UploadLagrangeMatrix(lagrange_matrix.GetData());
```

**–¢–æ—á–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∞**: —Å—Ç—Ä–æ–∫–∞ ~40 - –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ç—Ä–∏—Ü—ã –Ω–∞ GPU

---

### 2Ô∏è‚É£ –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ - ProcessingPipeline
**–§–∞–π–ª**: `src/processing_pipeline.cpp`  
**–°—Ç—Ä–æ–∫–∏**: 50-62

```cpp
std::vector<float> delay_coeffs(signal_buffer_->GetNumBeams(), 0.0f);
gpu_backend_->ExecuteFractionalDelay(
    device_buffer_,
    delay_coeffs.data(),
    signal_buffer_->GetNumBeams(),
    signal_buffer_->GetNumSamples()
);
```

**–¢–æ—á–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∞**: —Å—Ç—Ä–æ–∫–∞ 54 - –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º ExecuteFractionalDelay

---

### 3Ô∏è‚É£ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–¥–µ—Ä–∂–∫–∏
**–§–∞–π–ª**: `src/gpu_backend/opencl_backend.cpp`  
**–°—Ç—Ä–æ–∫–∏**: 159-230

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Å—Ç–∞**:
- **–°—Ç—Ä–æ–∫–∞ 165**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏
- **–°—Ç—Ä–æ–∫–∞ ~175**: –í—ã—á–∏—Å–ª–µ–Ω–∏–µ `delay_integer` –∏ `lagrange_row` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ª—É—á–∞
- **–°—Ç—Ä–æ–∫–∞ ~200**: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ kernel (6 –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤)
- **–°—Ç—Ä–æ–∫–∞ ~210**: –ó–∞–ø—É—Å–∫ kernel –Ω–∞ GPU

**–¢–æ—á–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∞**:
- –°—Ç—Ä–æ–∫–∞ 175 - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –°—Ç—Ä–æ–∫–∞ 200 - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã kernel
- –°—Ç—Ä–æ–∫–∞ 220 - –ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

---

### 4Ô∏è‚É£ OpenCL Kernel (GPU –∫–æ–¥)
**–§–∞–π–ª**: `kernels/kernel_fractional_delay.cl`  
**–°—Ç—Ä–æ–∫–∏**: 29-89

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Å—Ç–∞**:
- **–°—Ç—Ä–æ–∫–∞ 37**: –ü–æ–ª—É—á–µ–Ω–∏–µ `global_id`
- **–°—Ç—Ä–æ–∫–∞ 45-46**: –í—ã—á–∏—Å–ª–µ–Ω–∏–µ `beam_id` –∏ `sample_id`
- **–°—Ç—Ä–æ–∫–∞ 48-50**: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–¥–µ—Ä–∂–∫–∏
- **–°—Ç—Ä–æ–∫–∞ 53**: –í—ã—á–∏—Å–ª–µ–Ω–∏–µ `interp_idx` –¥–ª—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏
- **–°—Ç—Ä–æ–∫–∞ 59-84**: –¶–∏–∫–ª –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –õ–∞–≥—Ä–∞–Ω–∂–∞ (5 —Ç–æ—á–µ–∫)

**–¢–æ—á–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∞** (–≤ GPU –æ—Ç–ª–∞–¥—á–∏–∫–µ):
- –°—Ç—Ä–æ–∫–∞ 48 - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–µ—Ä–∂–∫–∏
- –°—Ç—Ä–æ–∫–∞ 60 - –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏
- –°—Ç—Ä–æ–∫–∞ 88 - –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

---

## üîç –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ

### –≠—Ç–∞–ø 1: –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç—Ä–∏—Ü—ã
- ‚úÖ –ú–∞—Ç—Ä–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ JSON (48√ó5 = 240 –∑–Ω–∞—á–µ–Ω–∏–π)
- ‚úÖ `lagrange_matrix.IsValid() == true`
- ‚úÖ `UploadLagrangeMatrix()` –≤–µ—Ä–Ω—É–ª true

### –≠—Ç–∞–ø 2: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–µ—Ä–∂–∫–∏
- ‚úÖ `delay_coefficients` - –º–∞—Å—Å–∏–≤ –Ω–µ–Ω—É–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–¥–ª—è —Ç–µ—Å—Ç–∞)
- ‚úÖ `delay_params[beam].delay_integer` - —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ
- ‚úÖ `delay_params[beam].lagrange_row` - –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [0, 47]

### –≠—Ç–∞–ø 3: –ê—Ä–≥—É–º–µ–Ω—Ç—ã kernel
- ‚úÖ –ê—Ä–≥—É–º–µ–Ω—Ç 0: input buffer (–≤–∞–ª–∏–¥–Ω—ã–π)
- ‚úÖ –ê—Ä–≥—É–º–µ–Ω—Ç 1: output buffer (–≤–∞–ª–∏–¥–Ω—ã–π)
- ‚úÖ –ê—Ä–≥—É–º–µ–Ω—Ç 2: lagrange_matrix_buffer (–≤–∞–ª–∏–¥–Ω—ã–π)
- ‚úÖ –ê—Ä–≥—É–º–µ–Ω—Ç 3: delay_params_buf (–≤–∞–ª–∏–¥–Ω—ã–π)
- ‚úÖ –ê—Ä–≥—É–º–µ–Ω—Ç 4: num_beams (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
- ‚úÖ –ê—Ä–≥—É–º–µ–Ω—Ç 5: num_samples (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)

### –≠—Ç–∞–ø 4: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ kernel
- ‚úÖ `global_size = num_beams * num_samples`
- ‚úÖ `work_group_size` - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä (256 –¥–ª—è RTX 3060)
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ OpenCL –ø–æ—Å–ª–µ `queue_.finish()`

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### DelayParams (–Ω–∞ GPU):
```c
struct DelayParams {
    int delay_integer;    // –¶–µ–ª–∞—è —á–∞—Å—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏
    int lagrange_row;     // –ò–Ω–¥–µ–∫—Å —Å—Ç—Ä–æ–∫–∏ –º–∞—Ç—Ä–∏—Ü—ã [0, 47]
};
```

### –ú–∞—Ç—Ä–∏—Ü–∞ –õ–∞–≥—Ä–∞–Ω–∂–∞:
- –†–∞–∑–º–µ—Ä: 48 —Å—Ç—Ä–æ–∫ √ó 5 —Å—Ç–æ–ª–±—Ü–æ–≤
- –§–æ—Ä–º–∞—Ç: `float[48 * 5]` (–ø–ª–æ—Å–∫–∏–π –º–∞—Å—Å–∏–≤)
- –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è: `matrix[row * 5 + col]`

---

## üéØ –ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –¢–µ—Å—Ç–æ–≤—ã–π —Å–ª—É—á–∞–π:
- `num_beams = 4`
- `num_samples = 1024`
- `delay_coefficients = [2.5, 3.25, 1.75, 0.125]`

### –û–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
–î–ª—è –ª—É—á–∞ 0 (`delay = 2.5`):
- `delay_integer = 2`
- `delay_fraction = 0.5`
- `lagrange_row = (int)(0.5 * 48) = 24`

–î–ª—è –ª—É—á–∞ 1 (`delay = 3.25`):
- `delay_integer = 3`
- `delay_fraction = 0.25`
- `lagrange_row = (int)(0.25 * 48) = 12`

---

## üìù –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º. `Doc/DEBUG_FRACTIONAL_DELAY.md` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è.

---

*–û–±–Ω–æ–≤–ª–µ–Ω–æ: 2025-01-28*  
*–í–µ—Ä—Å–∏—è: 2.0 (—Å –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–µ–π –õ–∞–≥—Ä–∞–Ω–∂–∞)*

