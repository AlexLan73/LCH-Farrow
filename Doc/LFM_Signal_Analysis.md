# Анализ класса LFM Signal Generator

## Краткое описание

Класс `LfmSignalGenerator` формирует **линейно-частотно-модулированные (ЛЧМ) сигналы** — сигналы с линейным изменением частоты во времени. Используется в радарных системах, гидроакустике и обработке сигналов.

---

## Структура класса

### Основные параметры (в .h файле):

```cpp
// Параметры ЛЧМ сигнала
struct LfmSignalParams {
    double f1;           // Начальная частота (Гц)
    double f2;           // Конечная частота (Гц)
    double duration;     // Длительность импульса (сек)
    double sample_rate;  // Частота дискретизации (Гц)
    double amplitude;    // Амплитуда сигнала
    int num_samples;     // Количество отсчётов
};
```

### Методы класса:

1. **`GenerateLfmSignal(params)`** — основной метод генерации сигнала
2. **`ApplyWindow(window_type)`** — применение окна (Hann, Hamming)
3. **`GetSignal()`** — получение сгенерированного сигнала
4. **`GetPhase()`** — получение фазы сигнала
5. **`Normalize()`** — нормализация амплитуды

---

## Математика ЛЧМ сигнала

**Формула ЛЧМ сигнала:**

```
s(t) = A * exp(j * 2π * [f1*t + (f2-f1)/(2*T) * t²])
```

где:
- `A` — амплитуда
- `f1` — начальная частота
- `f2` — конечная частота
- `T` — длительность сигнала
- `t` — время (от 0 до T)

**Мгновенная частота (линейно растёт):**
```
f(t) = f1 + (f2-f1)/T * t
```

---

## Рекомендуемые параметры для реальных сигналов

### Дано:
- **Тактовая частота:** 12 МГц
- **Максимум точек:** 1,300,000

### Рекомендуемые комбинации:

#### 1️⃣ **Гидроакустический сонар (низкие частоты)**
```cpp
f1 = 10_000 Hz       // 10 кГц (начальная)
f2 = 50_000 Hz       // 50 кГц (конечная)
duration = 0.1 sec   // 100 мс импульс
sample_rate = 12_000_000 Hz
num_samples = 1_200_000 (в пределах лимита)
bandwidth = 40 кГц (f2 - f1)
```

**Параметры:**
- Sweep time: 100 мс
- Частотная полоса: 40 кГц
- Временно-частотное разрешение: хорошее

---

#### 2️⃣ **Радарная система (средние частоты)**
```cpp
f1 = 100_000 Hz      // 100 кГц
f2 = 500_000 Hz      // 500 кГц
duration = 0.05 sec  // 50 мс импульс
sample_rate = 12_000_000 Hz
num_samples = 600_000
bandwidth = 400 кГц
```

**Параметры:**
- Sweep time: 50 мс
- Частотная полоса: 400 кГц
- Лучше разрешение по дальности

---

#### 3️⃣ **Ультразвуковая система (высокие частоты)**
```cpp
f1 = 500_000 Hz      // 500 кГц
f2 = 2_000_000 Hz    // 2 МГц
duration = 0.02 sec  // 20 мс импульс
sample_rate = 12_000_000 Hz
num_samples = 240_000
bandwidth = 1.5 МГц
```

**Параметры:**
- Sweep time: 20 мс
- Частотная полоса: 1.5 МГц
- Максимальное разрешение

---

#### 4️⃣ **Оптимальный для твоей системы (универсальный)**
```cpp
f1 = 50_000 Hz       // 50 кГц (начальная)
f2 = 500_000 Hz      // 500 кГц (конечная)
duration = 0.1 sec   // 100 мс
sample_rate = 12_000_000 Hz
num_samples = 1_200_000 (максимум!)
bandwidth = 450 кГц
amplitude = 1.0 (нормализованная)
```

**Оптимально потому что:**
- Использует максимум доступных точек (1.2М)
- Хороший баланс между разрешением по частоте и времени
- Охватывает диапазон от инфразвука до УЗ
- Длительность импульса достаточна для обработки

---

## Расчёты для твоей системы

### Максимальное время сигнала при 12 МГц:

```
T_max = num_samples / sample_rate
T_max = 1_300_000 / 12_000_000 = 0.108 сек = 108 мс
```

### Частотное разрешение ЛЧМ:

```
ΔF = Bandwidth / duration = (f2 - f1) / T
```

**Примеры:**
- Вариант 1: ΔF = 40 кГц / 0.1 сек = 400 кГц/сек
- Вариант 2: ΔF = 400 кГц / 0.05 сек = 8 МГц/сек
- Вариант 4: ΔF = 450 кГц / 0.1 сек = 4.5 МГц/сек

---

## Параметры работы класса

### Из кода `lfm_signal_generator.cpp`:

**В функции `GenerateLfmSignal()`:**

```cpp
// Вычисление коэффициента chirp rate
double chirp_rate = (f2 - f1) / duration;

// Для каждого отсчёта:
double t = n / sample_rate;
double phase = 2π * (f1 * t + chirp_rate/2 * t²);
double sample = amplitude * cos(phase);
```

**Окна (windowing):**
- Hann window — для уменьшения боковых лепестков
- Hamming window — для более гладкого спада

---

## Рекомендация для добавляемой функции

Когда будешь добавлять новую функцию в класс, она должна работать с:

1. **Фазой сигнала** — уже вычислена, можно переиспользовать
2. **Мгновенной частотой** — f(t) = f1 + chirp_rate * t
3. **Комплексными отсчётами** — класс работает с I/Q компонентами

**Потенциальные встроенные функции:**
- Фракционная задержка (Fractional Delay) с интерполяцией
- Доплеровский сдвиг
- Нелинейная частотная модуляция
- Фазовая модуляция поверх ЛЧМ

---

## Сохранено в памяти

✅ Файлы `lfm_signal_generator.h` и `lfm_signal_generator.cpp` сохранены
✅ Параметры реальных сигналов (первая и вторая частота) задокументированы
✅ Готово к добавлению встроенной функции
